<!DOCTYPE html>
<!--
  Copyright 2011 Google Inc. All Rights Reserved.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">

    <title>2014九合一選舉六都藍綠支持率差距</title>

    <!-- <link href="/apis/fusiontables/docs/samples/style/default.css" rel="stylesheet" type="text/css"> -->
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <link rel="stylesheet" type="text/css" href="https://rawgit.com/Jizz5566/2014_6cities/gh-pages/stylesheets/infotable.css">
    <style type="text/css">
    html,
    body,
    #map-canvas {
        height: 100%;
        margin: 0;
        padding: 0;
        width: auto;
        z-index: 3
    }
    #googft-legend {
        background-color: #fff;
        border: 1px solid #000;
        font-family: Arial, sans-serif;
        font-size: 12px;
        margin: 5px;
        padding: 10px 10px 8px
    }
    #googft-legend p {
        font-weight: bold;
        margin-top: 0
    }
    #googft-legend div {
        margin-bottom: 5px
    }
    .googft-legend-swatch {
        border: 1px solid;
        float: left;
        height: 12px;
        margin-right: 8px;
        width: 20px
    }
    .googft-legend-range {
        margin-left: 0;
        trans
    }
    .googft-dot-icon {
        margin-right: 8px
    }
    .googft-paddle-icon {
        height: 24px;
        left: -8px;
        margin-right: -8px;
        position: relative;
        vertical-align: middle;
        width: 24px
    }
    .googft-legend-source {
        margin-bottom: 0;
        margin-top: 8px
    }
    .googft-legend-source a {
        color: #666;
        font-size: 11px
    }
    </style>
    <script type="text/javascript">
    var map;
    var layer_ = [];
    //1VMKy6uAM3PTT9UhSZQTTBVzZxaEfLp5g6nyy2h6j
    var tableId = ['1MYUia1wz4XNWpDQCtXv578RFD2_lstUSP4rGsnTp', '1VMKy6uAM3PTT9UhSZQTTBVzZxaEfLp5g6nyy2h6j', '1zw0L4HbIz_dNFko8hxn5fUISMTfY3SbLiQzYlkkr'];
    // tableId0 = 六都2014各里圖層; tableId1 = 六都鄉鎮區圖層 ; tableId2 = 六都縣市圖層

    function initialize() {
        google.maps.visualRefresh = true;
        var isMobile = (navigator.userAgent.toLowerCase().indexOf('android') > -1) ||
            (navigator.userAgent.match(/(iPod|iPhone|iPad|BlackBerry|Windows Phone|iemobile)/));
        if (isMobile) {
            var viewport = document.querySelector("meta[name=viewport]");
            viewport.setAttribute('content', 'initial-scale=1.0, user-scalable=no');
        }
        var mapDiv = document.getElementById('map-canvas');
        mapDiv.style.width = isMobile ? '100%' : 'auto';
        mapDiv.style.height = isMobile ? '100%' : '100%';
        map = new google.maps.Map(document.getElementById('map-canvas'), {
            center: new google.maps.LatLng(24.95709976981357, 121.50977393610034),
            zoom: 10,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById('googft-legend-open'));
        map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById('googft-legend'));
        var style = [{
            featureType: 'all',
            elementType: 'all',
            stylers: [{
                "saturation": -75
            }, {
                "gamma": 1.87
            }, {
                "visibility": "simplified"
            }, {
                "weight": 0.6
            }]
        }];
        var styledMapType = new google.maps.StyledMapType(style, {
            map: map,
            name: 'Styled Map'
        });
        map.mapTypes.set('map-style', styledMapType);
        map.setMapTypeId('map-style');
        //用迴圈畫三層地圖
        for (var i = 0; i < 3; i++) {
            layer_[i] = new google.maps.FusionTablesLayer({
                query: {
                    select: "geometry",
                    from: tableId[i]
                },
                suppressInfoWindows: true,
                map: map,
                styleId: 2,
                templateId: 2
            });
            //console.log(layer_[i]);
        };

        google.maps.event.addListener(layer_[0], 'click', function(e) {
            if (infowindow) infowindow.close();
            else infowindow = new google.maps.InfoWindow();
            infowindow.setContent(
                '<table class="tg">' +
                '<tr>' +
                '<th class="tg-i8ik" colspan="3">' + e.row['County_NAME'].value + '</th>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-hgcj">區里名：</td>' +
                '<td class="tg-s6z2" id="villige" colspan="2">' + e.row['Villige_NAME'].value + '</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-hgcj">2014選舉人數：</td>' +
                '<td class="tg-s6z2" colspan="2">' + e.row['People'].value + '人</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-bghc" style="color:#000; background-color:#FFF">綠營支持率：</td>' +
                '<td class="tg-9bfu" style="color:#000; background-color:#FFF">藍營支持率：</td>' +
                '<td class="tg-465v" style="color:#000; background-color:#FFF">差值：</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-lhm3" style="background-color:#FFF">' + (e.row['綠營支持率'].value * 100).toFixed(2) + '%' + '</td>' +
                '<td class="tg-1uaf" style="background-color:#FFF">' + (e.row['藍營支持率'].value * 100).toFixed(2) + '%' + '</td>' +
                '<td class="tg-9vst" style="background-color:#0FF;font-weight:bold;font-size:16px;color:#F00">' + (e.row['diff'].value * 100).toFixed(2) + '%' + '</td>' +
                '</tr>' +
                '</table>'
            );
            infowindow.setPosition(e.latLng);
            infowindow.open(map);
        });
        infowindow = new google.maps.InfoWindow();
        //GeoJson();

        google.maps.event.addDomListener(document.getElementById('TPE'),
            'click',
            function() {
                if (infowindow) infowindow.close();
                filterMap(layer_, tableId, map);
                /*                filterMap2(layer_1, map);
                                filterMap0(layer_2, map);*/
            });

        google.maps.event.addDomListener(document.getElementById('XBE'),
            'click',
            function() {
                if (infowindow) infowindow.close();
                filterMap(layer_, tableId, map);
            });

        google.maps.event.addDomListener(document.getElementById('TAO'),
            'click',
            function() {
                if (infowindow) infowindow.close();
                filterMap(layer_, tableId, map);
            });
        google.maps.event.addDomListener(document.getElementById('TCH'),
            'click',
            function() {
                if (infowindow) infowindow.close();
                filterMap(layer_, tableId, map);
            });
        google.maps.event.addDomListener(document.getElementById('TNA'),
            'click',
            function() {
                if (infowindow) infowindow.close();
                filterMap(layer_, tableId, map);
            });
        google.maps.event.addDomListener(document.getElementById('KSH'),
            'click',
            function() {
                if (infowindow) infowindow.close();
                filterMap(layer_, tableId, map);
            });
    }

    // Filter the map based on checkbox selection.
    function filterMap(layer_, tableId, map) {
        var where = generateWhere();
        if (where) {
            for (var i = 0; i < 3; i++) {
                if (!layer_[i].getMap()) {
                    layer_[i].setMap(map);
                }
                layer_[i].setOptions({
                    query: {
                        select: 'geometry',
                        from: tableId[i],
                        where: where
                    },
                    styleId: 2,
                    templateId: 2,
                    //map: map
                });
            };
        } else {
            for (var i = 0; i < 3; i++) {
                layer_[i].setMap(null);
            };
        }
    }


    // Generate a where clause from the checkboxes. If no boxes
    // are checked, return an empty string.
    function generateWhere() {
        var filter = [];
        var stores = document.getElementsByName('store');
        for (var i = 0, store; store = stores[i]; i++) {
            if (store.checked) {
                var storeName = store.value.replace(/'/g, '\\\'');
                filter.push("'" + storeName + "'");
            }
        }
        var where = '';
        if (filter.length) {
            where = "'County_NAME' IN (" + filter.join(',') + ')';
        }
        //alert(where);
        return where;
    }

    google.maps.event.addDomListener(window, 'load', initialize);
    </script>
</head>

<body>
<h1>2014年選舉六都藍綠支持率差距</h1>
    <div id="container" class="zindex">
        <ol>
            <h3>圖表說明：</h3>
            <li>2014選舉六都藍綠的支持率差距，分為四級級距（顏色愈深代表藍綠差距愈大）：
                <ul>
                    <li>（1）-0.6～ -0.05</li>
                    <li>（2）0.05～0</li>
                    <li>（3）0～0.05</li>
                    <li>（4）0.05～0.7</li>
                </ul>
            </li>
            <li>未區分人數過少之里</li>
            <li>各縣市核取方塊可選擇單獨顯示縣市區域</li>
            <li>點選各里區塊，會顯示該里的支持率資訊。</li>
        </ol>
    </div>
    <P></P>
    <div>
        <input type="checkbox" checked="checked" name="store" id="TPE" value="台北市">
        <label>台北市</label>
        <input type="checkbox" checked="checked" name="store" id="XBE" value="新北市">
        <label>新北市</label>
        <input type="checkbox" checked="checked" name="store" id="TAO" value="桃園市">
        <label>桃園市</label>
        <input type="checkbox" checked="checked" name="store" id="TCH" value="台中市">
        <label>台中市</label>
        <input type="checkbox" checked="checked" name="store" id="TNA" value="台南市">
        <label>台南市</label>
        <input type="checkbox" checked="checked" name="store" id="KSH" value="高雄市">
        <label>高雄市</label>
    </div>
    <div id="map-canvas" style="width:auto; height:600px;"></div>
    <input id="googft-legend-open" style="display:none" type="button" value="Legend"></input>
    <div id="googft-legend">
        <p id="googft-legend-title">支持率差距</p>
        <div>
            <span class="googft-legend-swatch" style="background-color: rgba(0,0,255,0.4)"></span>
            <span class="googft-legend-range">-60% to -5%</span>
        </div>
        <div>
            <span class="googft-legend-swatch" style="background-color: rgba(61,133,198,0.4)"></span>
            <span class="googft-legend-range">-5% to 0%</span>
        </div>
        <div>
            <span class="googft-legend-swatch" style="background-color: rgba(106,168,79,0.4)"></span>
            <span class="googft-legend-range">0% to 5%</span>
        </div>
        <div>
            <span class="googft-legend-swatch" style="background-color: rgba(39,78,19,0.4)"></span>
            <span class="googft-legend-range">5% to 70%</span>
        </div>
        <input id="googft-legend-close" style="display:none" type="button" value="Hide"></input>
    </div>
</body>

</html>
