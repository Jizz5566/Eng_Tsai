<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <title>2010與2014年六都選舉藍綠勢力分佈圖</title>
    <meta charset="UTF-8">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="http://maplacejs.com/src/maplace-0.1.3.min.js?v=0.1.33"></script>
    <script type="text/javascript" src="https://googlemaps.github.io/js-map-label/src/maplabel-compiled.js"></script>
    <script src="http://piotrkrosniak.github.io/simple-slider.js"></script>
    <link href="https://rawgit.com/Jizz5566/2014_6cities/gh-pages/stylesheets/simple-slider.css" rel="stylesheet" type="text/css" />
    <link href="http://piotrkrosniak.github.io/simple-slider-volume.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://rawgit.com/Jizz5566/2014_6cities/gh-pages/stylesheets/infotable.css">
    <style type="text/css">
    html,
    body,
    #map_canvas {
        width: auto;
        top: 10px;
        height: 100%;
        margin: 0px;
        padding: 0px;
    }
    #googft-legend {
        background-color: #fff;
        border: 1px solid #000;
        font-family: Arial, sans-serif;
        font-size: 12px;
        margin: 5px;
        padding: 10px 10px 8px
    }
    #googft-legend p {
        font-weight: bold;
        margin-top: 0
    }
    #googft-legend div {
        margin-bottom: 5px
    }
    .googft-legend-swatch {
        border: 1px solid;
        float: left;
        height: 12px;
        margin-right: 8px;
        width: 20px
    }
    .googft-legend-range {
        margin-left: 0
    }
    .googft-dot-icon {
        margin-right: 8px
    }
    .googft-paddle-icon {
        height: 24px;
        left: -8px;
        margin-right: -8px;
        position: relative;
        vertical-align: middle;
        width: 24px
    }
    .googft-legend-source {
        margin-bottom: 0;
        margin-top: 8px
    }
    .googft-legend-source a {
        color: #666;
        font-size: 11px
    }
    </style>
    <script type="text/javascript">
    var layer2_1, layer3_1, layer2_2, layer3_2;
    var map, tableId;
    var infowindow = new google.maps.InfoWindow();

    function initialize() {
        google.maps.visualRefresh = true;
        var isMobile = (navigator.userAgent.toLowerCase().indexOf('android') > -1) ||
            (navigator.userAgent.match(/(iPod|iPhone|iPad|BlackBerry|Windows Phone|iemobile)/));
        if (isMobile) {
            var viewport = document.querySelector("meta[name=viewport]");
            viewport.setAttribute('content', 'initial-scale=1.0, user-scalable=no');
        }
        var mapDiv = document.getElementById('map_canvas');
        mapDiv.style.width = isMobile ? '100%' : 'auto';
        mapDiv.style.height = isMobile ? '100%' : '600px';
        var myLatLng = new google.maps.LatLng(24.97592870964595, 121.48632444044824);
        map = new google.maps.Map(document.getElementById('map_canvas'), {
            center: myLatLng,
            zoom: 10,
            panControl: false,
            zoomControl: true,
            zoomControlOptions: {
                position: google.maps.ControlPosition.LEFT_CENTER
            },
            mapTypeControl: false
        });
        map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById('googft-legend-open'));
        map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById('googft-legend'));
        var style = [{
            featureType: 'all',
            elementType: 'all',
            stylers: [{
                "saturation": -75
            }, {
                "gamma": 1.87
            }, {
                "visibility": "simplified"
            }, {
                "weight": 0.6
            }]
        }];
        var styledMapType = new google.maps.StyledMapType(style, {
            map: map,
            name: 'Styled Map'
        });
        map.mapTypes.set('map-style', styledMapType);
        map.setMapTypeId('map-style');

        // Replace the xxx with your Fusion Tables IDs. 
        //You can use FT Wizard http://fusion-tables-api-samples.googlecode.com/svn/trunk/FusionTablesLayerWizard/src/index.html
        $.ajax({
            url: "TWN_Town_6cities.geojson",
            type: "GET",
            dataType: "json",
            success: function(data) {
                //data = $.parseJSON(data);
                var markers = data.result;
                for (var i = 0; i < 158; i++) {
                    var lng = data.features[i].geometry.coordinates[0];
                    var lat = data.features[i].geometry.coordinates[1];
                    var town = data.features[i].properties.TOWN_NAME;
                    var mapLabel = new MapLabel({
                        minZoom: 8,
                        text: town,
                        position: new google.maps.LatLng(lat, lng),
                        map: map,
                        fontSize: 16,
                        fontColor: '#ffff00',
                        strokeWeight: 5,
                        strokeColor: '#000000',
                        zIndex: 2,
                        align: 'right'
                    });
                    mapLabel.set('position', mapLabel.position);
                }

            },
            error: function() {
                alert("ERROR!!!");
            }
        });

        layer2_1 = new google.maps.FusionTablesLayer({
            query: {
                select: 'geometry',
                from: '1MYUia1wz4XNWpDQCtXv578RFD2_lstUSP4rGsnTp', //2014-6 cities > 2000 people
                where: 'People > 2000'
            },
            suppressInfoWindows: true,
            styleId: 2,
            templateId: 2,
            map: map
        });
        layer2_2 = new google.maps.FusionTablesLayer({
            query: {
                select: 'geometry',
                from: '1MYUia1wz4XNWpDQCtXv578RFD2_lstUSP4rGsnTp', //2014-6 cities < 2000 people
                where: 'People < 2000'
            },
            suppressInfoWindows: true,
            styleId: 3,
            templateId: 3,
            map: map
        });


        layer3_2 = new google.maps.FusionTablesLayer({
            query: {
                select: 'col14>>1',
                from: '1lqsAhcETs5M8sY-GF7tYWdq-xLZ_x68iIUDeXIoA', //2010-6 cities < 2000 people
                where: 'People < 2000'
            },
            suppressInfoWindows: true,
            styleId: 3,
            templateId: 3,
            map: map
        });
        layer3_1 = new google.maps.FusionTablesLayer({
            query: {
                select: 'col14>>1',
                from: '1lqsAhcETs5M8sY-GF7tYWdq-xLZ_x68iIUDeXIoA', //2010-6 cities < 2000 people
                where: 'People > 2000'
            },
            suppressInfoWindows: true,
            styleId: 2,
            templateId: 2,
            map: map
        });

        //六都鄉鎮區圖層
        layer4_1 = new google.maps.FusionTablesLayer({
            query: {
                select: "col6",
                from: "1I6ITd8tYIUIgQQ9sLPqEMdF1k8SheurW8qZL3EL9"
            },
            suppressInfoWindows: true,
            map: map,
            styleId: 2,
            templateId: 2
        });
        //六都縣市圖層
        layer4_2 = new google.maps.FusionTablesLayer({
            query: {
                select: "col5",
                from: "1zw0L4HbIz_dNFko8hxn5fUISMTfY3SbLiQzYlkkr"
            },
            suppressInfoWindows: true,
            map: map,
            styleId: 2,
            templateId: 2
        });
        clearmap();
        layer3_1.setMap(map);
        layer3_2.setMap(map);
        layer4_1.setMap(map);
        layer4_2.setMap(map);

        google.maps.event.addListener(layer2_1, 'click', function(e) {
            var G_supt = Number(e.row['綠營支持率'].value).toFixed(4);
            var B_supt = Number(e.row['藍營支持率'].value).toFixed(4);
            var O_supt = Number(e.row['OTR'].value / e.row['People'].value).toFixed(4);
            if (infowindow) infowindow.close();
            else infowindow = new google.maps.InfoWindow();
            infowindow.setContent(
                '<table class="tg">' +
                '<tr>' +
                '<th class="tg-i8ik" colspan="3">' + e.row['County_NAME'].value + '</th>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-hgcj">區里名：</td>' +
                '<td class="tg-s6z2" id="villige" colspan="2">' + e.row['Villige_NAME'].value + '</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-hgcj">選舉人數：</td>' +
                '<td class="tg-s6z2" colspan="2">' + e.row['People'].value + '人</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-bghc">綠營得票數：</td>' +
                '<td class="tg-9bfu">藍營得票數：</td>' +
                '<td class="tg-465v">其他得票數：</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-lhm3">' + e.row['DPP'].value + '</td>' +
                '<td class="tg-1uaf">' + e.row['KMT'].value + '</td>' +
                '<td class="tg-9vst">' + e.row['OTR'].value + '</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-bghc">綠營支持率：</td>' +
                '<td class="tg-9bfu">藍營支持率：</td>' +
                '<td class="tg-465v">其他支持率：</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-lhm3">' + G_supt.substring(2, 4) + '.' + G_supt.substring(4, 6) + '%</td>' +
                '<td class="tg-iw8u">' + B_supt.substring(2, 4) + '.' + B_supt.substring(4, 6) + '%</td>' +
                '<td class="tg-9vst">' + O_supt.substring(3, 4) + '.' + O_supt.substring(4, 6) + '%</td>' +
                '</tr>' +
                '</table>'
            );
            infowindow.setPosition(e.latLng);
            infowindow.open(map);
        });
        google.maps.event.addListener(layer2_2, 'click', function(e) {
            var G_supt = Number(e.row['綠營支持率'].value).toFixed(4);
            var B_supt = Number(e.row['藍營支持率'].value).toFixed(4);
            var O_supt = Number(e.row['OTR'].value / e.row['People'].value).toFixed(4);
            if (infowindow) infowindow.close();
            else infowindow = new google.maps.InfoWindow();
            infowindow.setContent(
                '<table class="tg">' +
                '<tr>' +
                '<th class="tg-i8ik" colspan="3">' + e.row['County_NAME'].value + '</th>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-hgcj">區里名：</td>' +
                '<td class="tg-s6z2" id="villige" colspan="2">' + e.row['Villige_NAME'].value + '</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-hgcj">選舉人數：</td>' +
                '<td class="tg-s6z2" colspan="2">' + e.row['People'].value + '人</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-bghc">綠營得票數：</td>' +
                '<td class="tg-9bfu">藍營得票數：</td>' +
                '<td class="tg-465v">其他得票數：</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-lhm3">' + e.row['DPP'].value + '</td>' +
                '<td class="tg-1uaf">' + e.row['KMT'].value + '</td>' +
                '<td class="tg-9vst">' + e.row['OTR'].value + '</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-bghc">綠營支持率：</td>' +
                '<td class="tg-9bfu">藍營支持率：</td>' +
                '<td class="tg-465v">其他支持率：</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-lhm3">' + G_supt.substring(2, 4) + '.' + G_supt.substring(4, 6) + '%</td>' +
                '<td class="tg-iw8u">' + B_supt.substring(2, 4) + '.' + B_supt.substring(4, 6) + '%</td>' +
                '<td class="tg-9vst">' + O_supt.substring(3, 4) + '.' + O_supt.substring(4, 6) + '%</td>' +
                '</tr>' +
                '</table>'
            );
            infowindow.setPosition(e.latLng);
            infowindow.open(map);
        });
        google.maps.event.addListener(layer3_1, 'click', function(e) {
            var G_supt = Number(e.row['綠營支持率'].value).toFixed(4);
            var B_supt = Number(e.row['藍營支持率'].value).toFixed(4);
            var O_supt = Number(e.row['OTR'].value / e.row['People'].value).toFixed(4);
            if (infowindow) infowindow.close();
            else infowindow = new google.maps.InfoWindow();
            infowindow.setContent(
                '<table class="tg">' +
                '<tr>' +
                '<th class="tg-i8ik" colspan="3">' + e.row['County_NAME'].value + '</th>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-hgcj">區里名：</td>' +
                '<td class="tg-s6z2" id="villige" colspan="2">' + e.row['Villige_NAME'].value + '</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-hgcj">選舉人數：</td>' +
                '<td class="tg-s6z2" colspan="2">' + e.row['People'].value + '人</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-bghc">綠營得票數：</td>' +
                '<td class="tg-9bfu">藍營得票數：</td>' +
                '<td class="tg-465v">其他得票數：</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-lhm3">' + e.row['DPP'].value + '</td>' +
                '<td class="tg-1uaf">' + e.row['KMT'].value + '</td>' +
                '<td class="tg-9vst">' + e.row['OTR'].value + '</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-bghc">綠營支持率：</td>' +
                '<td class="tg-9bfu">藍營支持率：</td>' +
                '<td class="tg-465v">其他支持率：</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-lhm3">' + G_supt.substring(2, 4) + '.' + G_supt.substring(4, 6) + '%</td>' +
                '<td class="tg-iw8u">' + B_supt.substring(2, 4) + '.' + B_supt.substring(4, 6) + '%</td>' +
                '<td class="tg-9vst">' + O_supt.substring(3, 4) + '.' + O_supt.substring(4, 6) + '%</td>' +
                '</tr>' +
                '</table>'
            );
            infowindow.setPosition(e.latLng);
            infowindow.open(map);
        });
        google.maps.event.addListener(layer3_2, 'click', function(e) {
            var G_supt = Number(e.row['綠營支持率'].value).toFixed(4);
            var B_supt = Number(e.row['藍營支持率'].value).toFixed(4);
            var O_supt = Number(e.row['OTR'].value / e.row['People'].value).toFixed(4);
            if (infowindow) infowindow.close();
            else infowindow = new google.maps.InfoWindow();
            infowindow.setContent(
                '<table class="tg">' +
                '<tr>' +
                '<th class="tg-i8ik" colspan="3">' + e.row['County_NAME'].value + '</th>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-hgcj">區里名：</td>' +
                '<td class="tg-s6z2" id="villige" colspan="2">' + e.row['Villige_NAME'].value + '</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-hgcj">選舉人數：</td>' +
                '<td class="tg-s6z2" colspan="2">' + e.row['People'].value + '人</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-bghc">綠營得票數：</td>' +
                '<td class="tg-9bfu">藍營得票數：</td>' +
                '<td class="tg-465v">其他得票數：</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-lhm3">' + e.row['DPP'].value + '</td>' +
                '<td class="tg-1uaf">' + e.row['KMT'].value + '</td>' +
                '<td class="tg-9vst">' + e.row['OTR'].value + '</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-bghc">綠營支持率：</td>' +
                '<td class="tg-9bfu">藍營支持率：</td>' +
                '<td class="tg-465v">其他支持率：</td>' +
                '</tr>' +
                '<tr>' +
                '<td class="tg-lhm3">' + G_supt.substring(2, 4) + '.' + G_supt.substring(4, 6) + '%</td>' +
                '<td class="tg-iw8u">' + B_supt.substring(2, 4) + '.' + B_supt.substring(4, 6) + '%</td>' +
                '<td class="tg-9vst">' + O_supt.substring(3, 4) + '.' + O_supt.substring(4, 6) + '%</td>' +
                '</tr>' +
                '</table>'
            );
            infowindow.setPosition(e.latLng);
            infowindow.open(map);
        });
        if (isMobile) {
            var legend = document.getElementById('googft-legend');
            var legendOpenButton = document.getElementById('googft-legend-open');
            var legendCloseButton = document.getElementById('googft-legend-close');
            legend.style.display = 'none';
            legendOpenButton.style.display = 'block';
            legendCloseButton.style.display = 'block';
            legendOpenButton.onclick = function() {
                legend.style.display = 'block';
                legendOpenButton.style.display = 'none';
            }
            legendCloseButton.onclick = function() {
                legend.style.display = 'none';
                legendOpenButton.style.display = 'block';
            }
        }
    }

    google.maps.event.addDomListener(window, 'load', initialize);

    tableidselections = 0;

    function filterMap2(layer2_1, layer2_2, tableId, map) { //2014
        var where = generateWhere();
        //alert(where);
        if (where) {
            if (!layer2_1.getMap()) {
                layer2_1.setMap(map);
            } else if (!layer2_2.getMap()) {
                layer2_2.setMap(map);
            }
            layer2_1.setOptions({
                query: {
                    select: 'geometry',
                    from: tableId,
                    where: where
                },
                styleId: 2,
                templateId: 2,
                map: map
            });
            layer2_2.setOptions({
                query: {
                    select: 'geometry',
                    from: tableId,
                    where: where
                },
                styleId: 3,
                templateId: 3,
                map: map
            });
        } else {
            layer.setMap(null);
        }
    }

    function filterMap3(layer3_1, layer3_2, map) { //2010
        var where = generateWhere();
        if (where) {
            if (!layer3_1.getMap()) {
                layer3_1.setMap(map);
            } else if (!layer3_2.getMap()) {
                layer3_2.setMap(map);
            }
            layer3_1.setOptions({
                query: {
                    select: 'col14>>1',
                    from: tableId,
                    where: where
                },
                styleId: 2,
                templateId: 2,
                map: map
            });
            layer3_2.setOptions({
                query: {
                    select: 'col14>>1',
                    from: tableId,
                    where: where
                },
                styleId: 3,
                templateId: 3,
                map: map
            });
        } else {
            layer3_1.setMap(null);
            //alert(where);
        }
    }

    function OtherLayer(layer4_1, layer4_2, map, where) {
        //六都鄉鎮區圖層
        var layer4_1 = new google.maps.FusionTablesLayer({
            query: {
                select: "col6>>0",
                from: "1I6ITd8tYIUIgQQ9sLPqEMdF1k8SheurW8qZL3EL9",
                where: where
            },
            suppressInfoWindows: true,
            map: map,
            styleId: 2,
            templateId: 2
        });
        //六都縣市圖層
        var layer4_2 = new google.maps.FusionTablesLayer({
            query: {
                select: "col5",
                from: "1zw0L4HbIz_dNFko8hxn5fUISMTfY3SbLiQzYlkkr",
                where: where
            },
            suppressInfoWindows: true,
            map: map,
            styleId: 2,
            templateId: 2
        });
    }

    // Generate a where clause from the checkboxes. If no boxes
    // are checked, return an empty string.
    function generateWhere() {
        var filter = [];
        var stores = document.getElementsByName('store');
        for (var i = 0, store; store = stores[i]; i++) {
            if (store.checked) {
                var storeName = store.value.replace(/'/g, '\\\'');
                filter.push("'" + storeName + "'");
            }
        }
        var where = '';
        if (filter.length) {
            where = "'County_NAME' IN (" + filter.join(',') + ')';
        }
        return where;
    }


    function changeLayer(tableidselections) {

        if (tableidselections == 2010) {
            tableId = '1lqsAhcETs5M8sY-GF7tYWdq-xLZ_x68iIUDeXIoA';
            infowindow.close();
            clearmap();
            layer3_1.setMap(map);
            layer3_2.setMap(map);
            layer4_1.setMap(map);
            layer4_2.setMap(map);
        }

        if (tableidselections == 2014) {
            tableId = '1MYUia1wz4XNWpDQCtXv578RFD2_lstUSP4rGsnTp';
            infowindow.close();
            clearmap();
            layer2_1.setMap(map);
            layer2_2.setMap(map);
            layer4_1.setMap(map);
            layer4_2.setMap(map);
        }


    }

    function clearmap() {
        if (layer2_1 != null) {
            layer2_1.setMap(null);
        };
        if (layer3_1 != null) {
            layer3_1.setMap(null);
        };
        if (layer2_2 != null) {
            layer2_2.setMap(null);
        };
        if (layer3_2 != null) {
            layer3_2.setMap(null);
        };
    }
    </script>

    <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900%7CQuicksand:400,700%7CQuestrial" rel="stylesheet" />
    <!-- <link href="http://piotrkrosniak.github.io/default.css" rel="stylesheet" type="text/css" media="all" />
    <link href="http://piotrkrosniak.github.io/fonts.css" rel="stylesheet" type="text/css" media="all" /> -->
    <!--[if IE 6]><link href="default_ie6.css" rel="stylesheet" type="text/css" /><![endif]-->
</head>

<body>
<h1 class="">2010-2014年選舉六都藍綠支持率差距</h1>
    <div id="container">
        <ol>
            <h3>圖表說明：</h3>
            <li>2010與2014兩年度選舉的藍綠支持率差距，分為四級級距（顏色愈深代表藍綠差距愈大）：
                <ul>
                    <li>（1）-0.6（-0.7）～ -0.05</li>
                    <li>（2）0.05～0</li>
                    <li>（3）0～0.05</li>
                    <li>（4）0.05～0.7</li>
                </ul>
            </li>
            <li>Slider選軸兩邊可切換年度，左上角黑色固定區塊顯示年度</li>
            <li>點選各里區塊，會顯示該里的支持率資訊。</li>
        </ol>
    </div>
    <div>
        <div id="slider" class="container">
            <h3 id="h3" style="top:5px; left:80px; position:relative;z-index:2;">Drag the slider to change Year</h3>
            <input data-slider="true" data-slider-values="2010,2014" data-slider-highlight="true" data-slider-snap="true" type="text" />
        </div>
        <script>
        $("[data-slider]")
            .each(function() {
                var input = $(this);
                $("<span>")
                    .addClass("output")
                    .insertAfter($(this));
            })
            .bind("slider:ready slider:changed", function(event, data) {
                $(this)
                    .nextAll(".output:first")
                    .html(data.value.toFixed(0));
                tableidselections = data.value.toFixed(0);
                changeLayer(tableidselections);
                if (tableidselections == 2010) {
                    $('.googft-legend-range:first').text('-70% to -5%');
                } else if (tableidselections == 2014) {
                    $('.googft-legend-range:first').text('-60% to -5%');
                }
            });
        </script>
        <div id="map_canvas"></div>
        <input id="googft-legend-open" style="display:none" type="button" value="Legend"></input>
        <div id="googft-legend">
            <p id="googft-legend-title">支持率差距</p>
            <div>
                <span class="googft-legend-swatch" style="background-color: rgba(0,0,255,0.4)"></span>
                <span class="googft-legend-range">-70% to -5%</span>
            </div>
            <div>
                <span class="googft-legend-swatch" style="background-color: rgba(61,133,198,0.4)"></span>
                <span class="googft-legend-range">-5% to 0%</span>
            </div>
            <div>
                <span class="googft-legend-swatch" style="background-color: rgba(106,168,79,0.4)"></span>
                <span class="googft-legend-range">0% to 5%</span>
            </div>
            <div>
                <span class="googft-legend-swatch" style="background-color: rgba(39,78,19,0.4)"></span>
                <span class="googft-legend-range">5% to 70%</span>
            </div>
            <input id="googft-legend-close" style="display:none" type="button" value="Hide"></input>
        </div>

</body>

</html>
